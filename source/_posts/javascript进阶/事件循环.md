---
title: 事件循环
date: 2024-04-17
tags:
categories: javascript进阶
---

##

### 如何理解 js 的异步

JS 是一门`单线程`的语言，这是因为它运行在浏览器的`渲染主线程`中，而渲染主线程只有一个。而渲染主线程承担着诸多的工作，`渲染页面`、`执行 JS` 都在其中运行。
如果使用同步的方式，就极有可能导致主线程产生阻塞，从而导致消息队列中的很多其他任务无法得到执行。这样一来，一方面会导致繁忙的主线程白白的消耗时间，另一方面导致页面无法及时更新，给用户造成卡死现象。
所以浏览器采用异步的方式来避免。具体做法是当某些任务发生时，比如计时器、网络、事件监听，`主线程`将任务交给`其他线程`去处理，自身立即结束任务的执行，转而执行后续代码。当其他线程完成时，将事先传递的回调函数`包装`成`任务`，加入到消息队列的末尾排队，等待主线程调度执行。在这种异步模式下，浏览器永不阻塞，从而最大限度的保证了单线程的流畅运行。

### 浏览器的事件循环

事件循环又叫做消息循环，是浏览器`渲染主线程`的工作方式。
在 Chrome 的源码中，它开启一个不会结束的 `for` 循环，每次循环从消息队列中取出第一个任务执行，而其他线程只需要在合适的时候将任务加入到队列未尾即可。
过去把消息队列简单分为`宏队列`和`微队列`，这种说法目前已无法满足复杂的浏览器环境，取而代之的是一种更加灵活多变的处理方式。

根据 W3C 官方的解释，每个任务有不`同的类型`，同类型的任务必须在同一个队列，不同的任务可以属于不同的队列的任务。不同的任务有不同的优先级，在一次事件循环中，由浏览器自行决定取必须有一个`微队列`，`微队列`(微队列 > 交互队列 > 定时器队列)的任务定具有最高的优先级，必须优先调度执行。
